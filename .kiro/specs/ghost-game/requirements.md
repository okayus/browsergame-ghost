# Requirements Document

## Introduction

ブラウザゲーム「Ghost」は、ゴーストを捕まえて育成し、ターン制バトルで戦う2D RPGです。プレイヤーは俯瞰視点でグリッドベースのマップを探索し、野生のゴーストと遭遇します。捕まえたゴーストでパーティを編成し、タイプ相性を活かした戦略的なバトルを楽しめます。

## Requirements

### Requirement 1: マップ探索

**Objective:** As a プレイヤー, I want グリッドベースのマップ上でキャラクターを移動させたい, so that ゴーストと遭遇してバトルや捕獲ができる

#### Acceptance Criteria

1. When プレイヤーが方向キー（wasd）を入力した時, the ゲームシステム shall キャラクターを該当方向の隣接グリッドへ1マス移動させる
2. When キャラクターが移動不可のタイル（壁、障害物）に移動しようとした時, the ゲームシステム shall 移動をブロックしてキャラクターを現在位置に留める
3. When キャラクターがエンカウント可能エリア（草むらなど）を移動した時, the ゲームシステム shall 一定確率で野生ゴーストとのバトルを発生させる
4. The ゲームシステム shall マップを俯瞰視点（トップダウンビュー）で表示する
5. The ゲームシステム shall キャラクターの現在位置をマップ上で視覚的に識別可能に表示する

### Requirement 2: ゴースト基本データ

**Objective:** As a プレイヤー, I want 各ゴーストが固有のタイプ・能力値・技を持つことで, so that 多様なゴーストを収集・育成する楽しみがある

#### Acceptance Criteria

1. The ゲームシステム shall 各ゴーストに種類ID、名前、タイプ（属性）を定義する
2. The ゲームシステム shall 各ゴーストに基本能力値（HP、攻撃、防御、素早さ）を定義する
3. The ゲームシステム shall 各ゴーストにレベルを設定し、レベルに応じて能力値を計算する
4. The ゲームシステム shall 各ゴーストが習得可能な技（わざ）のリストを定義する
5. When ゴーストがレベルアップした時, the ゲームシステム shall 能力値を再計算して更新する

### Requirement 3: タイプ相性システム

**Objective:** As a プレイヤー, I want ゴーストのタイプによる相性（有利・不利）があることで, so that バトルに戦略性が生まれる

#### Acceptance Criteria

1. The ゲームシステム shall 複数のゴーストタイプ（例：炎、水、草、電気、霊など）を定義する
2. The ゲームシステム shall タイプ間の相性表（効果抜群、いまひとつ、効果なし）を定義する
3. When 技を使用した時, the ゲームシステム shall 攻撃側の技タイプと防御側のゴーストタイプから相性倍率を計算する
4. When タイプ相性が「効果抜群」の時, the ゲームシステム shall ダメージを増加（例：2倍）させる
5. When タイプ相性が「いまひとつ」の時, the ゲームシステム shall ダメージを減少（例：0.5倍）させる
6. When タイプ相性が「効果なし」の時, the ゲームシステム shall ダメージを0にする

### Requirement 4: ターン制コマンドバトル

**Objective:** As a プレイヤー, I want ターン制でコマンドを選択してゴーストをバトルさせたい, so that 戦略を考えながら戦える

#### Acceptance Criteria

1. When バトルが開始した時, the ゲームシステム shall プレイヤーのゴーストと野生ゴーストを対峙させたバトル画面を表示する
2. The ゲームシステム shall コマンド選択肢（たたかう、アイテム、逃げる、捕まえる）を表示する
3. When プレイヤーが「たたかう」を選択した時, the ゲームシステム shall 使用可能な技のリストを表示する
4. When 両者のコマンドが決定した時, the ゲームシステム shall 素早さを比較して行動順序を決定する
5. When 技を使用した時, the ゲームシステム shall ダメージを計算して相手のHPを減少させる
6. When ゴーストのHPが0以下になった時, the ゲームシステム shall そのゴーストを戦闘不能状態にする
7. When 野生ゴーストが戦闘不能になった時, the ゲームシステム shall バトル終了とし、経験値を付与する
8. When プレイヤーのゴーストが全て戦闘不能になった時, the ゲームシステム shall バトル敗北として処理する

### Requirement 5: ゴースト捕獲

**Objective:** As a プレイヤー, I want 野生ゴーストを捕まえてパーティに加えたい, so that 様々なゴーストを収集できる

#### Acceptance Criteria

1. When プレイヤーがバトル中に「捕まえる」コマンドを選択した時, the ゲームシステム shall 捕獲用アイテムの選択画面を表示する
2. When 捕獲アイテムを使用した時, the ゲームシステム shall 捕獲成功率を計算する
3. While 野生ゴーストのHPが低い時, the ゲームシステム shall 捕獲成功率を上昇させる
4. When 捕獲が成功した時, the ゲームシステム shall 野生ゴーストをプレイヤーの手持ちに追加する
5. When 捕獲が失敗した時, the ゲームシステム shall 捕獲アイテムを消費しバトルを継続する
6. If 手持ちゴーストが上限に達している時に捕獲成功した場合, the ゲームシステム shall ボックス（保管場所）に送るか入れ替えるかの選択肢を表示する

### Requirement 6: パーティ管理

**Objective:** As a プレイヤー, I want 手持ちゴーストのパーティを管理したい, so that バトルに出すゴーストを選べる

#### Acceptance Criteria

1. The ゲームシステム shall 手持ちゴースト（パーティ）の上限を6体とする
2. The ゲームシステム shall パーティ内のゴースト一覧と各ゴーストのステータスを表示する
3. When プレイヤーがパーティ内のゴーストの順番を変更した時, the ゲームシステム shall バトル開始時に先頭のゴーストが出場する
4. When バトル中にゴーストが戦闘不能になった時, the ゲームシステム shall 次のゴーストを選択する画面を表示する
5. While バトル中にプレイヤーのターンの時, the ゲームシステム shall 戦闘中のゴーストを手持ちの別のゴーストと交代可能にする

### Requirement 7: アイテムシステム

**Objective:** As a プレイヤー, I want アイテムを使用してゴーストを回復・捕獲したい, so that バトルを有利に進められる

#### Acceptance Criteria

1. The ゲームシステム shall アイテムの種類（回復系、捕獲系、その他）を定義する
2. The ゲームシステム shall プレイヤーの所持アイテム一覧を管理する
3. When プレイヤーがバトル中に「アイテム」を選択した時, the ゲームシステム shall 使用可能なアイテム一覧を表示する
4. When HP回復アイテムを使用した時, the ゲームシステム shall 対象ゴーストのHPを回復させる
5. When アイテムを使用した時, the ゲームシステム shall 所持数を1減少させる
6. If アイテムの所持数が0の時, the ゲームシステム shall そのアイテムを使用不可として表示する

### Requirement 8: 経験値とレベルアップ

**Objective:** As a プレイヤー, I want ゴーストを育成してレベルアップさせたい, so that より強いゴーストに成長させられる

#### Acceptance Criteria

1. When バトルに勝利した時, the ゲームシステム shall 参加したゴーストに経験値を付与する
2. The ゲームシステム shall 倒した野生ゴーストのレベルに応じて獲得経験値を計算する
3. When ゴーストの経験値が次のレベルに必要な値に達した時, the ゲームシステム shall レベルアップを実行する
4. When レベルアップした時, the ゲームシステム shall 能力値を再計算して強化する
5. When レベルアップ時に新しい技を習得可能な時, the ゲームシステム shall 技習得の通知を表示する
6. If 習得済み技が上限（4つ）に達している場合に新技を習得する時, the ゲームシステム shall 既存の技と入れ替えるかどうかの選択肢を表示する

### Requirement 9: 逃げる機能

**Objective:** As a プレイヤー, I want バトルから逃げたい, so that 不利な戦闘を回避できる

#### Acceptance Criteria

1. When プレイヤーが「逃げる」コマンドを選択した時, the ゲームシステム shall 逃走成功率を計算する
2. The ゲームシステム shall 自分のゴーストと野生ゴーストの素早さを比較して逃走成功率を決定する
3. When 逃走に成功した時, the ゲームシステム shall バトルを終了してマップ画面に戻る
4. When 逃走に失敗した時, the ゲームシステム shall ターンを消費してバトルを継続する

### Requirement 10: ゲーム画面とUI

**Objective:** As a プレイヤー, I want 見やすいゲーム画面で操作したい, so that ストレスなくゲームを楽しめる

#### Acceptance Criteria

1. The ゲームシステム shall マップ画面、バトル画面、メニュー画面を切り替え可能にする
2. The ゲームシステム shall バトル画面で両ゴーストのHP、名前、レベルを表示する
3. The ゲームシステム shall バトル中のダメージ、状態変化、行動をメッセージで表示する
4. The ゲームシステム shall キーボード操作（wasd、決定キー、キャンセルキー）に対応する
5. When 画面遷移が発生した時, the ゲームシステム shall 適切なトランジション効果を表示する

### Requirement 11: プレイヤー登録と初期化

**Objective:** As a 新規ユーザー, I want 認証後に自動的にゲームを開始したい, so that すぐにゲームを楽しめる

#### Acceptance Criteria

1. When ユーザーが初めてサインインした時, the ゲームシステム shall 新規プレイヤーデータを自動作成する
2. When 新規プレイヤーデータを作成する時, the ゲームシステム shall 初期ゴースト1体をパーティに追加する
3. When 新規プレイヤーデータを作成する時, the ゲームシステム shall 初期アイテム（捕獲用ボール、回復アイテム）を付与する
4. When 新規プレイヤーデータを作成する時, the ゲームシステム shall プレイヤーの初期位置をマップ上の開始地点に設定する
5. The ゲームシステム shall 作成したプレイヤーデータをバックエンドに保存する

### Requirement 12: 認証状態とゲーム画面遷移

**Objective:** As a ユーザー, I want 認証状態に応じて適切な画面を表示したい, so that シームレスにゲームにアクセスできる

#### Acceptance Criteria

1. While ユーザーが未認証の時, the ゲームシステム shall ウェルカム画面（サインイン/サインアップボタン）を表示する
2. When ユーザーが認証に成功した時, the ゲームシステム shall バックエンドからセーブデータを読み込む
3. If セーブデータが存在しない時, the ゲームシステム shall 新規プレイヤー初期化処理を実行する
4. When セーブデータの読み込みが完了した時, the ゲームシステム shall マップ画面（ゲームメイン画面）に遷移する
5. While セーブデータを読み込み中の時, the ゲームシステム shall ローディング表示を行う
6. If セーブデータの読み込みに失敗した時, the ゲームシステム shall エラーメッセージを表示しリトライオプションを提供する

### Requirement 13: セーブデータ永続化

**Objective:** As a プレイヤー, I want ゲームの進行状況を保存したい, so that 次回プレイ時に続きから遊べる

#### Acceptance Criteria

1. The ゲームシステム shall プレイヤーのセーブデータ（位置、パーティ、インベントリ）をClerk認証IDに紐づけて保存する
2. When ゲーム状態に変更があった時, the ゲームシステム shall 自動的にセーブデータを更新する
3. When ユーザーがサインインした時, the ゲームシステム shall 保存されたセーブデータを復元する
4. If バックエンドとの通信に失敗した時, the ゲームシステム shall ローカルにデータを一時保存し、復旧後に同期する
5. The ゲームシステム shall セーブデータの最終更新日時を記録する

### Requirement 14: パーティ画面表示

**Objective:** As a プレイヤー, I want メニューからパーティ画面を開いて手持ちゴーストを確認したい, so that バトルに出すゴーストの状態を把握できる

#### Acceptance Criteria

1. When プレイヤーがメニューで「パーティ」を選択した時, the ゲームシステム shall パーティ画面に遷移する
2. The ゲームシステム shall パーティ画面で手持ちゴースト一覧（最大6体）を表示する
3. The ゲームシステム shall 各ゴーストの名前、レベル、現在HP/最大HPを表示する
4. When プレイヤーがゴーストを選択した時, the ゲームシステム shall そのゴーストの詳細情報（タイプ、能力値、覚えている技）を表示する
5. The ゲームシステム shall パーティ画面でキーボード操作（上下移動、決定、キャンセル）に対応する
6. When プレイヤーがキャンセル操作をした時, the ゲームシステム shall メニュー画面に戻る

---

_Requirements generated based on steering context and EARS format guidelines_
